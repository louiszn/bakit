# Contributing to Bakit

Thank you for your interest in contributing to Bakit! This project uses a **changelog-driven release workflow** powered by [Changesets](https://github.com/changesets/changesets). Please read this guide carefully before opening an issue or pull request - it will save time for both you and the maintainers.

## Table of Contents

- [How Releases Work](#how-releases-work)
- [Repository Structure](#repository-structure)
- [Prerequisites](#prerequisites)
- [Setting Up the Project](#setting-up-the-project)
- [Making Changes](#making-changes)
- [Testing Your Changes](#testing-your-changes)
- [Commit Guidelines](#commit-guidelines)
- [Adding a Changeset (Changelog Entry)](#adding-a-changeset-changelog-entry)
- [Opening a Pull Request](#opening-a-pull-request)
- [Getting Help](#getting-help)

## How Releases Work

- **All changes are declared using Changesets.**  
  Every pull request that affects user-visible behavior **must** include a changeset.
- **Versioning, tagging, and publishing are fully automated.**  
  After a pull request is merged, CI automatically bumps versions, updates `CHANGELOG.md` files, creates a GitHub release, and publishes packages to npm (if applicable).
- **Contributors never manually bump package versions or edit changelogs.**  
  Do not edit `package.json` versions or `CHANGELOG.md` files directly - they are managed by Changesets and CI.

## Repository Structure

Bakit is a monorepo managed with [PNPM workspaces](https://pnpm.io/workspaces). The main packages are located under `packages/`:

```
packages/
├── core/        # Core functionality
├── gateway/     # Gateway client
├── rest/        # REST API client
├── service/     # Service layer utilities
├── utils/       # Shared utilities
└── ...          # Additional packages
```

Each package has its own `package.json` and a `CHANGELOG.md` (automatically generated by Changesets).

## Prerequisites

- **Node.js** - version 22 or higher
- **PNPM** - install via `npm install -g pnpm` or corepack (`corepack enable`)

## Setting Up the Project

1. **Fork and clone** the repository:

   ```sh
   git clone https://github.com/your-username/bakit.git
   cd bakit
   ```

2. **Install dependencies** and build all packages:

   ```sh
   pnpm install
   pnpm build
   ```

3. **Verify everything works** by running tests:
   ```sh
   pnpm test
   ```

You are now ready to make changes!

## Making Changes

- Create a new branch from `main`:

  ```sh
  git checkout -b feat/your-feature-name
  ```

- Make your changes, following the existing code style and patterns.
- If you're adding or modifying a public API, update the corresponding documentation (usually in `README.md` or JSDoc comments).
- Write or update tests as needed (see [Testing Your Changes](#testing-your-changes)).

## Testing Your Changes

- Run **unit tests** for all packages:
  ```sh
  pnpm test
  ```
- Run tests for a specific package (example for `@bakit/rest`):
  ```sh
  pnpm --filter @bakit/rest test
  ```
- If you add a feature or fix a bug, please include appropriate tests.

## Commit Guidelines

We enforce a **conventional commit message format** to improve readability and enable automation. Your commit messages should be structured as follows:

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

**Allowed types:**

- `feat:` - A new feature
- `fix:` - A bug fix
- `docs:` - Documentation only changes
- `chore:` - Internal tooling, refactors with no behavior change, or maintenance tasks
- `refactor:` - Code change that neither fixes a bug nor adds a feature (no behavior change)
- `style:` - Changes that do not affect the meaning of the code (white-space, formatting, etc.)
- `test:` - Adding missing tests or correcting existing tests

**Breaking changes** must be indicated by adding a `!` after the type/scope, for example:

```
feat!(rest): use new API
```

This signals that the change requires a major version bump.

Examples:

```sh
git commit -m "feat(rest): add support for custom headers"
git commit -m "fix(gateway): handle connection timeout"
git commit -m "docs: update installation instructions"
```

Note: The changeset you create later will determine the actual version bump (patch, minor, major). The commit message itself does not drive versioning, but following this convention helps maintainers and automation understand the nature of your change.

## Adding a Changeset (Changelog Entry)

**When is a changeset required?**  
You must add a changeset if your change is **user-visible**, for example:

- Bug fixes
- New features
- Behavior changes
- Deprecations or removals
- Anything that affects how someone uses the library

You **do not** need a changeset for:

- Refactors with no behavior change
- Internal tooling improvements
- Tests
- Documentation-only changes (though you may still need to update `README.md`)

**How to add a changeset:**

1. Run the following command from the project root:

   ```sh
   pnpm -w changeset add
   ```

   This will start an interactive prompt asking you to:
   - Select the packages affected by your change (use spacebar to select).
   - Choose the type of change (`patch`, `minor`, or `major`) for each selected package.
   - Write a short description of the change.

2. The command creates a new Markdown file in the `.changeset/` directory (e.g., `.changeset/eleven-bears-itch.md`).

3. **Do not** run `pnpm changeset version` - that is handled automatically after your PR is merged.  
   **Do not** manually edit `package.json` versions or `CHANGELOG.md` files.

4. Commit the generated changeset file along with your code changes:
   ```sh
   git add .changeset/
   git commit -m "chore: add changeset"
   ```

If you are unsure about the impact of your change, ask in [Discord](#getting-help) - we're happy to help.

## Opening a Pull Request

1. **Push your branch** to your fork:

   ```sh
   git push origin feat/your-feature-name
   ```

2. **Open a pull request** against the `main` branch of the main repository.
3. Fill out the PR template with a clear description of your changes.
4. If your change requires a changeset but you forgot to add one, CI will remind you - you can add it later by pushing another commit.

All pull requests go through automated checks (tests, linting, changeset validation). Once approved and merged, the release process kicks in automatically.

## Getting Help

If anything in this guide is unclear, or if you're unsure how your change should be handled, **please ask**! We'd rather answer questions early than have to fix things later.

- Join our [Discord](https://discord.gg/XXSBYg4HGc) and chat with us.
- Open a [discussion](https://github.com/louiszn/bakit/discussions) on GitHub.

Every contribution - whether it's a bug fix, a new feature, or just feedback - genuinely helps move the project forward. Thank you for helping make Bakit better for everyone!
